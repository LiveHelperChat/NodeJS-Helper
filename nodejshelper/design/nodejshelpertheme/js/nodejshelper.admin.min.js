!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).socketCluster=t()}(function(){return function r(o,i,s){function a(e,t){if(!i[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(c)return c(e,!0);throw(n=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",n}n=i[e]={exports:{}},o[e][0].call(n.exports,function(t){return a(o[e][1][t]||t)},n,n.exports,r,o,i,s)}return i[e].exports}for(var c="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,n){var r=t("./lib/scclientsocket"),o=t("./lib/factory");e.exports.factory=o,e.exports.SCClientSocket=r,e.exports.Emitter=t("component-emitter"),e.exports.create=function(t){return o.create(t)},e.exports.connect=e.exports.create,e.exports.destroy=function(t){return o.destroy(t)},e.exports.clients=o.clients,e.exports.version="13.0.1"},{"./lib/factory":3,"./lib/scclientsocket":5,"component-emitter":12}],2:[function(t,e,n){!function(o){function t(){this._internalStorage={},this.isLocalStorageEnabled=this._checkLocalStorageEnabled()}t.prototype._checkLocalStorageEnabled=function(){var e;try{o.localStorage,o.localStorage.setItem("__scLocalStorageTest",1),o.localStorage.removeItem("__scLocalStorageTest")}catch(t){e=t}return!e},t.prototype.saveToken=function(t,e,n,r){this.isLocalStorageEnabled&&o.localStorage?o.localStorage.setItem(t,e):this._internalStorage[t]=e,r&&r(null,e)},t.prototype.removeToken=function(t,e){var n;this.loadToken(t,function(t,e){n=e}),this.isLocalStorageEnabled&&o.localStorage?o.localStorage.removeItem(t):delete this._internalStorage[t],e&&e(null,n)},t.prototype.loadToken=function(t,e){t=this.isLocalStorageEnabled&&o.localStorage?o.localStorage.getItem(t):this._internalStorage[t]||null;e(null,t)},e.exports.AuthEngine=t}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n,t){!function(s){var a=e("./scclientsocket"),t=e("sc-errors"),c=e("uuid"),u=t.InvalidArgumentsError,h={};n.exports={create:function(t){if((t=t||{}).host&&!t.host.match(/[^:]+:\d{2,5}/))throw new u('The host option should include both the hostname and the port number in the format "hostname:port"');if(t.host&&t.hostname)throw new u('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and hostname options together');if(t.host&&t.port)throw new u('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and port options together');var e,n,r,o=s.location&&"https:"==location.protocol,i={port:(n=o,n=null==(e=t).secure?n:e.secure,e.port||(s.location&&location.port?location.port:n?443:80)),hostname:s.location&&location.hostname||"localhost",path:"/socketcluster/",secure:o,autoConnect:!0,autoReconnect:!0,autoSubscribeOnConnect:!0,connectTimeout:2e4,ackTimeout:1e4,timestampRequests:!1,timestampParam:"t",authEngine:null,authTokenName:"socketCluster.authToken",binaryType:"arraybuffer",multiplex:!0,pubSubBatchDuration:null,cloneData:!1};for(r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);return i.clientMap=h,!1!==i.multiplex?(i.clientId=function(t){var e=t.secure?"https://":"http://",n="";if(t.query)if("string"==typeof t.query)n=t.query;else{var r,o=[],i=t.query;for(r in i)i.hasOwnProperty(r)&&o.push(r+"="+i[r]);o.length&&(n="?"+o.join("&"))}return e+(t.host||t.hostname+":"+t.port)+t.path+n}(i),h[i.clientId]?i.autoConnect&&h[i.clientId].connect():h[i.clientId]=new a(i),h[i.clientId]):(i.clientId=c.v4(),o=new a(i),h[i.clientId]=o)},destroy:function(t){t.destroy()},clients:h}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./scclientsocket":5,"sc-errors":21,uuid:23}],4:[function(t,e,n){var r=t("sc-errors"),o=r.InvalidActionError,t=function(t,e){this.socket=t,this.id=e,this.sent=!1};t.prototype._respond=function(t){if(this.sent)throw new o("Response "+this.id+" has already been sent");this.sent=!0,this.socket.send(this.socket.encode(t))},t.prototype.end=function(t){var e;this.id&&(e={rid:this.id},void 0!==t&&(e.data=t),this._respond(e))},t.prototype.error=function(t,e){this.id&&(t=r.dehydrateError(t),t={rid:this.id,error:t},void 0!==e&&(t.data=e),this._respond(t))},t.prototype.callback=function(t,e){t?this.error(t,e):this.end(e)},e.exports.Response=t},{"sc-errors":21}],5:[function(E,w,t){!function(o,e){function r(t){var e=this;i.call(this),this.id=null,this.state=this.CLOSED,this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null,this.pendingReconnect=!1,this.pendingReconnectTimeout=null,this.preparingPendingSubscriptions=!1,this.clientId=t.clientId,this.connectTimeout=t.connectTimeout,this.ackTimeout=t.ackTimeout,this.channelPrefix=t.channelPrefix||null,this.disconnectOnUnload=null==t.disconnectOnUnload||t.disconnectOnUnload,this.authTokenName=t.authTokenName,this.pingTimeout=this.ackTimeout,this.pingTimeoutDisabled=!!t.pingTimeoutDisabled,this.active=!0,this._clientMap=t.clientMap||{};var n=Math.pow(2,31)-1,r=function(t){if(e[t]>n)throw new d("The "+t+" value provided exceeded the maximum amount allowed")};r("connectTimeout"),r("ackTimeout"),this._localEvents={connect:1,connectAbort:1,close:1,disconnect:1,message:1,error:1,raw:1,kickOut:1,subscribe:1,unsubscribe:1,subscribeStateChange:1,authStateChange:1,authenticate:1,deauthenticate:1,removeAuthToken:1,subscribeRequest:1},this.connectAttempts=0,this._emitBuffer=new h,this.channels={},this.options=t,this._cid=1,this.options.callIdGenerator=function(){return e._cid++},this.options.autoReconnect&&(null==this.options.autoReconnectOptions&&(this.options.autoReconnectOptions={}),null==(r=this.options.autoReconnectOptions).initialDelay&&(r.initialDelay=1e4),null==r.randomness&&(r.randomness=1e4),null==r.multiplier&&(r.multiplier=1.5),null==r.maxDelay&&(r.maxDelay=6e4)),null==this.options.subscriptionRetryOptions&&(this.options.subscriptionRetryOptions={}),this.options.authEngine?this.auth=this.options.authEngine:this.auth=new a,this.options.codecEngine?this.codec=this.options.codecEngine:this.codec=c,this.options.path=this.options.path.replace(/\/$/,"")+"/",this.options.query=t.query||{},"string"==typeof this.options.query&&(this.options.query=u.parse(this.options.query)),this._channelEmitter=new i,this._unloadHandler=function(){e.disconnect()},v&&this.disconnectOnUnload&&o.addEventListener&&o.addEventListener("beforeunload",this._unloadHandler,!1),(this._clientMap[this.clientId]=this).options.autoConnect&&this.connect()}var i=E("component-emitter"),s=E("sc-channel").SCChannel,a=(E("./response").Response,E("./auth").AuthEngine),c=E("sc-formatter"),n=E("./sctransport").SCTransport,u=E("querystring"),h=E("linked-list"),l=E("base-64"),p=E("clone"),f=E("sc-errors"),d=f.InvalidArgumentsError,t=f.InvalidMessageError,y=f.InvalidActionError,m=f.SocketProtocolError,g=f.TimeoutError,b=f.BadConnectionError,v="undefined"!=typeof window;r.prototype=Object.create(i.prototype),r.CONNECTING=r.prototype.CONNECTING=n.prototype.CONNECTING,r.OPEN=r.prototype.OPEN=n.prototype.OPEN,r.CLOSED=r.prototype.CLOSED=n.prototype.CLOSED,r.AUTHENTICATED=r.prototype.AUTHENTICATED="authenticated",r.UNAUTHENTICATED=r.prototype.UNAUTHENTICATED="unauthenticated",r.PENDING=r.prototype.PENDING="pending",r.ignoreStatuses=f.socketProtocolIgnoreStatuses,r.errorStatuses=f.socketProtocolErrorStatuses,r.prototype._privateEventHandlerMap={"#publish":function(t){var e=this._undecorateChannelName(t.channel);this.isSubscribed(e,!0)&&this._channelEmitter.emit(e,t.data)},"#kickOut":function(t){var e=this._undecorateChannelName(t.channel),n=this.channels[e];n&&(i.prototype.emit.call(this,"kickOut",t.message,e),n.emit("kickOut",t.message,e),this._triggerChannelUnsubscribe(n))},"#setAuthToken":function(e,n){var r=this;e?this.auth.saveToken(this.authTokenName,e.token,{},function(t){t?(n.error(t),r._onSCError(t)):(r._changeToAuthenticatedState(e.token),n.end())}):n.error(new t("No token data provided by #setAuthToken event"))},"#removeAuthToken":function(t,n){var r=this;this.auth.removeToken(this.authTokenName,function(t,e){t?(n.error(t),r._onSCError(t)):(i.prototype.emit.call(r,"removeAuthToken",e),r._changeToUnauthenticatedStateAndClearTokens(),n.end())})},"#disconnect":function(t){this.transport.close(t.code,t.data)}},r.prototype.getState=function(){return this.state},r.prototype.getBytesReceived=function(){return this.transport.getBytesReceived()},r.prototype.deauthenticate=function(n){var r=this;this.auth.removeToken(this.authTokenName,function(t,e){t?r._onSCError(t):(i.prototype.emit.call(r,"removeAuthToken",e),r.state!=r.CLOSED&&r.emit("#removeAuthToken"),r._changeToUnauthenticatedStateAndClearTokens()),n&&n(t)})},r.prototype.connect=r.prototype.open=function(){var t,r=this;this.active?this.state==this.CLOSED&&(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this.state=this.CONNECTING,i.prototype.emit.call(this,"connecting"),this.transport&&this.transport.off(),this.transport=new n(this.auth,this.codec,this.options),this.transport.on("open",function(t){r.state=r.OPEN,r._onSCOpen(t)}),this.transport.on("error",function(t){r._onSCError(t)}),this.transport.on("close",function(t,e){r.state=r.CLOSED,r._onSCClose(t,e)}),this.transport.on("openAbort",function(t,e){r.state=r.CLOSED,r._onSCClose(t,e,!0)}),this.transport.on("event",function(t,e,n){r._onSCEvent(t,e,n)})):(t=new y("Cannot connect a destroyed client"),this._onSCError(t))},r.prototype.reconnect=function(t,e){this.disconnect(t,e),this.connect()},r.prototype.disconnect=function(t,e){if("number"!=typeof(t=t||1e3))throw new d("If specified, the code argument must be a number");this.state==this.OPEN||this.state==this.CONNECTING?this.transport.close(t,e):(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef))},r.prototype.destroy=function(t,e){v&&o.removeEventListener&&o.removeEventListener("beforeunload",this._unloadHandler,!1),this.active=!1,this.disconnect(t,e),delete this._clientMap[this.clientId]},r.prototype._changeToUnauthenticatedStateAndClearTokens=function(){var t,e;this.authState!=this.UNAUTHENTICATED&&(e=this.authState,t=this.signedAuthToken,this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null,e={oldState:e,newState:this.authState},i.prototype.emit.call(this,"authStateChange",e),i.prototype.emit.call(this,"deauthenticate",t))},r.prototype._changeToAuthenticatedState=function(t){var e;this.signedAuthToken=t,this.authToken=this._extractAuthTokenData(t),this.authState!=this.AUTHENTICATED&&(e=this.authState,this.authState=this.AUTHENTICATED,e={oldState:e,newState:this.authState,signedAuthToken:t,authToken:this.authToken},this.preparingPendingSubscriptions||this.processPendingSubscriptions(),i.prototype.emit.call(this,"authStateChange",e)),i.prototype.emit.call(this,"authenticate",t)},r.prototype.decodeBase64=function(t){return void 0===e?o.atob?o.atob(t):l.decode(t):new e(t,"base64").toString("utf8")},r.prototype.encodeBase64=function(t){return void 0===e?o.btoa?o.btoa(t):l.encode(t):new e(t,"utf8").toString("base64")},r.prototype._extractAuthTokenData=function(e){e=(e||"").split(".")[1];if(null!=e){e=e;try{return e=this.decodeBase64(e),JSON.parse(e)}catch(t){return e}}return null},r.prototype.getAuthToken=function(){return this.authToken},r.prototype.getSignedAuthToken=function(){return this.signedAuthToken},r.prototype.authenticate=function(n,r){var o=this;this.emit("#authenticate",n,function(t,e){e&&null!=e.isAuthenticated?e.authError&&(e.authError=f.hydrateError(e.authError)):e={isAuthenticated:o.authState,authError:null},t?("BadConnectionError"!=t.name&&"TimeoutError"!=t.name&&o._changeToUnauthenticatedStateAndClearTokens(),r&&r(t,e)):o.auth.saveToken(o.authTokenName,n,{},function(t){t&&o._onSCError(t),e.isAuthenticated?o._changeToAuthenticatedState(n):o._changeToUnauthenticatedStateAndClearTokens(),r&&r(t,e)})})},r.prototype._tryReconnect=function(t){var e,n=this,r=this.connectAttempts++,o=this.options.autoReconnectOptions;(t=null==t||0<r?(e=Math.round(o.initialDelay+(o.randomness||0)*Math.random()),Math.round(e*Math.pow(o.multiplier,r))):t)>o.maxDelay&&(t=o.maxDelay),clearTimeout(this._reconnectTimeoutRef),this.pendingReconnect=!0,this.pendingReconnectTimeout=t,this._reconnectTimeoutRef=setTimeout(function(){n.connect()},t)},r.prototype._onSCOpen=function(t){var e=this;this.preparingPendingSubscriptions=!0,t?(this.id=t.id,this.pingTimeout=t.pingTimeout,this.transport.pingTimeout=this.pingTimeout,t.isAuthenticated?this._changeToAuthenticatedState(t.authToken):this._changeToUnauthenticatedStateAndClearTokens()):this._changeToUnauthenticatedStateAndClearTokens(),this.connectAttempts=0,this.options.autoSubscribeOnConnect&&this.processPendingSubscriptions(),i.prototype.emit.call(this,"connect",t,function(){e.processPendingSubscriptions()}),this.state==this.OPEN&&this._flushEmitBuffer()},r.prototype._onSCError=function(t){var e=this;setTimeout(function(){if(e.listeners("error").length<1)throw t;i.prototype.emit.call(e,"error",t)},0)},r.prototype._suspendSubscriptions=function(){var t,e,n;for(n in this.channels)this.channels.hasOwnProperty(n)&&(e=(t=this.channels[n]).state==t.SUBSCRIBED||t.state==t.PENDING?t.PENDING:t.UNSUBSCRIBED,this._triggerChannelUnsubscribe(t,e))},r.prototype._abortAllPendingEventsDueToBadConnection=function(t){for(var e=this._emitBuffer.head;e;){var n=e.next,r=e.data;clearTimeout(r.timeout),delete r.timeout,e.detach();var e=n,o=r.callback;o&&(delete r.callback,n="Event '"+r.event+"' was aborted due to a bad connection",n=new b(n,t),o.call(r,n,r)),r.cid&&this.transport.cancelPendingResponse(r.cid)}},r.prototype._onSCClose=function(t,e,n){this.id=null,this.transport&&this.transport.off(),this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this._suspendSubscriptions(),this._abortAllPendingEventsDueToBadConnection(n?"connectAbort":"disconnect"),this.options.autoReconnect&&(4e3==t||4001==t||1005==t?this._tryReconnect(0):1e3!=t&&t<4500&&this._tryReconnect()),n?i.prototype.emit.call(this,"connectAbort",t,e):i.prototype.emit.call(this,"disconnect",t,e),i.prototype.emit.call(this,"close",t,e),r.ignoreStatuses[t]||(e=e?"Socket connection closed with status code "+t+" and reason: "+e:"Socket connection closed with status code "+t,t=new m(r.errorStatuses[t]||e,t),this._onSCError(t))},r.prototype._onSCEvent=function(t,e,n){var r=this._privateEventHandlerMap[t];r?r.call(this,e,n):i.prototype.emit.call(this,t,e,function(){n&&n.callback.apply(n,arguments)})},r.prototype.decode=function(t){return this.transport.decode(t)},r.prototype.encode=function(t){return this.transport.encode(t)},r.prototype._flushEmitBuffer=function(){for(var t=this._emitBuffer.head;t;){var e=t.next,n=t.data;t.detach(),this.transport.emitObject(n),t=e}},r.prototype._handleEventAckTimeout=function(t,e){e&&e.detach(),delete t.timeout;var n=t.callback;n&&(delete t.callback,e=new g("Event response for '"+t.event+"' timed out"),n.call(t,e,t)),t.cid&&this.transport.cancelPendingResponse(t.cid)},r.prototype._emit=function(t,e,n){var r=this;this.state==this.CLOSED&&this.connect();var o={event:t,callback:n},i=new h.Item;this.options.cloneData?o.data=p(e):o.data=e,(i.data=o).timeout=setTimeout(function(){r._handleEventAckTimeout(o,i)},this.ackTimeout),this._emitBuffer.append(i),this.state==this.OPEN&&this._flushEmitBuffer()},r.prototype.send=function(t){this.transport.send(t)},r.prototype.emit=function(t,e,n){null==this._localEvents[t]?this._emit(t,e,n):"error"==t?i.prototype.emit.call(this,t,e):(t=new y('The "'+t+'" event is reserved and cannot be emitted on a client socket'),this._onSCError(t))},r.prototype.publish=function(t,e,n){e={channel:this._decorateChannelName(t),data:e};this.emit("#publish",e,n)},r.prototype._triggerChannelSubscribe=function(t,e){var n,r=t.name;t.state!=t.SUBSCRIBED&&(n=t.state,t.state=t.SUBSCRIBED,n={channel:r,oldState:n,newState:t.state,subscriptionOptions:e},t.emit("subscribeStateChange",n),t.emit("subscribe",r,e),i.prototype.emit.call(this,"subscribeStateChange",n),i.prototype.emit.call(this,"subscribe",r,e))},r.prototype._triggerChannelSubscribeFail=function(t,e,n){var r=e.name,o=!e.waitForAuth||this.authState==this.AUTHENTICATED;e.state!=e.UNSUBSCRIBED&&o&&(e.state=e.UNSUBSCRIBED,e.emit("subscribeFail",t,r,n),i.prototype.emit.call(this,"subscribeFail",t,r,n))},r.prototype._cancelPendingSubscribeCallback=function(t){null!=t._pendingSubscriptionCid&&(this.transport.cancelPendingResponse(t._pendingSubscriptionCid),delete t._pendingSubscriptionCid)},r.prototype._decorateChannelName=function(t){return t=this.channelPrefix?this.channelPrefix+t:t},r.prototype._undecorateChannelName=function(t){return this.channelPrefix&&0==t.indexOf(this.channelPrefix)?t.replace(this.channelPrefix,""):t},r.prototype._trySubscribe=function(e){var n,r=this,t=!e.waitForAuth||this.authState==this.AUTHENTICATED;this.state==this.OPEN&&!this.preparingPendingSubscriptions&&null==e._pendingSubscriptionCid&&t&&(t={noTimeout:!0},n={channel:this._decorateChannelName(e.name)},e.waitForAuth&&(t.waitForAuth=!0,n.waitForAuth=t.waitForAuth),e.data&&(n.data=e.data),e.batch&&(t.batch=!0,n.batch=!0),e._pendingSubscriptionCid=this.transport.emit("#subscribe",n,t,function(t){delete e._pendingSubscriptionCid,t?r._triggerChannelSubscribeFail(t,e,n):r._triggerChannelSubscribe(e,n)}),i.prototype.emit.call(this,"subscribeRequest",e.name,n))},r.prototype.subscribe=function(t,e){var n=this.channels[t];return n?e&&n.setOptions(e):(n=new s(t,this,e),this.channels[t]=n),n.state==n.UNSUBSCRIBED&&(n.state=n.PENDING,this._trySubscribe(n)),n},r.prototype._triggerChannelUnsubscribe=function(t,e){var n=t.name,r=t.state;t.state=e||t.UNSUBSCRIBED,this._cancelPendingSubscribeCallback(t),r==t.SUBSCRIBED&&(r={channel:n,oldState:r,newState:t.state},t.emit("subscribeStateChange",r),t.emit("unsubscribe",n),i.prototype.emit.call(this,"subscribeStateChange",r),i.prototype.emit.call(this,"unsubscribe",n))},r.prototype._tryUnsubscribe=function(t){var e;this.state==this.OPEN&&(e={noTimeout:!0},t.batch&&(e.batch=!0),this._cancelPendingSubscribeCallback(t),t=this._decorateChannelName(t.name),this.transport.emit("#unsubscribe",t,e))},r.prototype.unsubscribe=function(t){t=this.channels[t];t&&t.state!=t.UNSUBSCRIBED&&(this._triggerChannelUnsubscribe(t),this._tryUnsubscribe(t))},r.prototype.channel=function(t,e){var n=this.channels[t];return n||(n=new s(t,this,e),this.channels[t]=n),n},r.prototype.destroyChannel=function(t){var e=this.channels[t];e&&(e.unwatch(),e.unsubscribe(),delete this.channels[t])},r.prototype.subscriptions=function(t){var e,n,r=[];for(n in this.channels)this.channels.hasOwnProperty(n)&&(e=this.channels[n],(t?e&&(e.state==e.SUBSCRIBED||e.state==e.PENDING):e&&e.state==e.SUBSCRIBED)&&r.push(n));return r},r.prototype.isSubscribed=function(t,e){t=this.channels[t];return e?!!t&&(t.state==t.SUBSCRIBED||t.state==t.PENDING):!!t&&t.state==t.SUBSCRIBED},r.prototype.processPendingSubscriptions=function(){var e=this;this.preparingPendingSubscriptions=!1;var t,n,r=[];for(t in this.channels)!this.channels.hasOwnProperty(t)||(n=this.channels[t]).state==n.PENDING&&r.push(n);r.sort(function(t,e){t=t.priority||0,e=e.priority||0;return e<t?-1:t<e?1:0}),r.forEach(function(t){e._trySubscribe(t)})},r.prototype.watch=function(t,e){if("function"!=typeof e)throw new d("No handler function was provided");this._channelEmitter.on(t,e)},r.prototype.unwatch=function(t,e){e?this._channelEmitter.removeListener(t,e):this._channelEmitter.removeAllListeners(t)},r.prototype.watchers=function(t){return this._channelEmitter.listeners(t)},w.exports=r}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("buffer").Buffer)},{"./auth":2,"./response":4,"./sctransport":6,"base-64":8,buffer:10,clone:11,"component-emitter":12,"linked-list":15,querystring:18,"sc-channel":19,"sc-errors":21,"sc-formatter":22}],6:[function(e,h,t){!function(t){var n,o=e("component-emitter"),i=e("./response").Response,r=e("querystring"),s=t.WebSocket?(n=t.WebSocket,function(t,e){return new n(t)}):(n=e("ws"),function(t,e){return new n(t,null,e)}),a=e("sc-errors"),c=a.TimeoutError,u=a.BadConnectionError,t=function(t,e,n){var r=this;this.state=this.CLOSED,this.auth=t,this.codec=e,this.options=n,this.connectTimeout=n.connectTimeout,this.pingTimeout=n.ackTimeout,this.pingTimeoutDisabled=!!n.pingTimeoutDisabled,this.callIdGenerator=n.callIdGenerator,this.authTokenName=n.authTokenName,this._pingTimeoutTicker=null,this._callbackMap={},this._batchSendList=[],this.state=this.CONNECTING;n=this.uri(),n=s(n,this.options);n.binaryType=this.options.binaryType,(this.socket=n).onopen=function(){r._onOpen()},n.onclose=function(t){var e=null==t.code?1005:t.code;r._onClose(e,t.reason)},n.onmessage=function(t,e){r._onMessage(t.data)},n.onerror=function(t){r.state===r.CONNECTING&&r._onClose(1006)},this._connectTimeoutRef=setTimeout(function(){r._onClose(4007),r.socket.close(4007)},this.connectTimeout)};t.prototype=Object.create(o.prototype),t.CONNECTING=t.prototype.CONNECTING="connecting",t.OPEN=t.prototype.OPEN="open",t.CLOSED=t.prototype.CLOSED="closed",t.prototype.uri=function(){var t,e=this.options.query||{},n=this.options.secure?"wss":"ws";return this.options.timestampRequests&&(e[this.options.timestampParam]=(new Date).getTime()),(e=r.encode(e)).length&&(e="?"+e),n+"://"+(this.options.host||(t="",this.options.port&&("wss"==n&&443!=this.options.port||"ws"==n&&80!=this.options.port)&&(t=":"+this.options.port),this.options.hostname+t))+this.options.path+e},t.prototype._onOpen=function(){var r=this;clearTimeout(this._connectTimeoutRef),this._resetPingTimeout(),this._handshake(function(t,e){var n;t?(n=e&&e.code?e.code:4003,r._onError(t),r._onClose(n,t.toString()),r.socket.close(n)):(r.state=r.OPEN,o.prototype.emit.call(r,"open",e),r._resetPingTimeout())})},t.prototype._handshake=function(r){var e=this;this.auth.loadToken(this.authTokenName,function(t,n){t?r(t):e.emit("#handshake",{authToken:n},{force:!0},function(t,e){e&&(e.authToken=n,e.authError&&(e.authError=a.hydrateError(e.authError))),r(t,e)})})},t.prototype._abortAllPendingEventsDueToBadConnection=function(t){for(var e in this._callbackMap){var n,r;this._callbackMap.hasOwnProperty(e)&&(n=this._callbackMap[e],delete this._callbackMap[e],clearTimeout(n.timeout),delete n.timeout,r="Event '"+n.event+"' was aborted due to a bad connection",e=new u(r,t),r=n.callback,delete n.callback,r.call(n,e,n))}},t.prototype._onClose=function(t,e){delete this.socket.onopen,delete this.socket.onclose,delete this.socket.onmessage,delete this.socket.onerror,clearTimeout(this._connectTimeoutRef),clearTimeout(this._pingTimeoutTicker),clearTimeout(this._batchTimeout),this.state==this.OPEN?(this.state=this.CLOSED,o.prototype.emit.call(this,"close",t,e),this._abortAllPendingEventsDueToBadConnection("disconnect")):this.state==this.CONNECTING&&(this.state=this.CLOSED,o.prototype.emit.call(this,"openAbort",t,e),this._abortAllPendingEventsDueToBadConnection("connectAbort"))},t.prototype._handleEventObject=function(t,e){var n,r;t&&null!=t.event?(r=new i(this,t.cid),o.prototype.emit.call(this,"event",t.event,t.data,r)):t&&null!=t.rid?(n=this._callbackMap[t.rid])&&(clearTimeout(n.timeout),delete n.timeout,delete this._callbackMap[t.rid],n.callback&&(r=a.hydrateError(t.error),n.callback(r,t.data))):o.prototype.emit.call(this,"event","raw",e)},t.prototype._onMessage=function(t){o.prototype.emit.call(this,"event","message",t);var e=this.decode(t);if("#1"==e)this._resetPingTimeout(),this.socket.readyState==this.socket.OPEN&&this.sendObject("#2");else if(Array.isArray(e))for(var n=e.length,r=0;r<n;r++)this._handleEventObject(e[r],t);else this._handleEventObject(e,t)},t.prototype._onError=function(t){o.prototype.emit.call(this,"error",t)},t.prototype._resetPingTimeout=function(){var t;this.pingTimeoutDisabled||(t=this,(new Date).getTime(),clearTimeout(this._pingTimeoutTicker),this._pingTimeoutTicker=setTimeout(function(){t._onClose(4e3),t.socket.close(4e3)},this.pingTimeout))},t.prototype.getBytesReceived=function(){return this.socket.bytesReceived},t.prototype.close=function(t,e){t=t||1e3,this.state==this.OPEN?(this.emit("#disconnect",{code:t,data:e}),this._onClose(t,e),this.socket.close(t)):this.state==this.CONNECTING&&(this._onClose(t,e),this.socket.close(t))},t.prototype.emitObject=function(t,e){var n={event:t.event,data:t.data};return t.callback&&(n.cid=t.cid=this.callIdGenerator(),this._callbackMap[t.cid]=t),this.sendObject(n,e),t.cid||null},t.prototype._handleEventAckTimeout=function(t){t.cid&&delete this._callbackMap[t.cid],delete t.timeout;var e,n=t.callback;n&&(delete t.callback,e=new c("Event response for '"+t.event+"' timed out"),n.call(t,e,t))},t.prototype.emit=function(t,e,n,r){var o,i=this;r?(o=n,a=r):n instanceof Function?(o={},a=n):o=n;var s={event:t,data:e,callback:a};a&&!o.noTimeout&&(s.timeout=setTimeout(function(){i._handleEventAckTimeout(s)},this.options.ackTimeout));var a=null;return a=this.state==this.OPEN||o.force?this.emitObject(s,o):a},t.prototype.cancelPendingResponse=function(t){delete this._callbackMap[t]},t.prototype.decode=function(t){return this.codec.decode(t)},t.prototype.encode=function(t){return this.codec.encode(t)},t.prototype.send=function(t){this.socket.readyState!=this.socket.OPEN?this._onClose(1005):this.socket.send(t)},t.prototype.serializeObject=function(t){var e,n;try{e=this.encode(t)}catch(t){this._onError(n=t)}return n?null:e},t.prototype.sendObjectBatch=function(t){var e=this;this._batchSendList.push(t),this._batchTimeout||(this._batchTimeout=setTimeout(function(){var t;delete e._batchTimeout,e._batchSendList.length&&(null!=(t=e.serializeObject(e._batchSendList))&&e.send(t),e._batchSendList=[])},this.options.pubSubBatchDuration||0))},t.prototype.sendObjectSingle=function(t){t=this.serializeObject(t);null!=t&&this.send(t)},t.prototype.sendObject=function(t,e){e&&e.batch?this.sendObjectBatch(t):this.sendObjectSingle(t)},h.exports.SCTransport=t}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./response":4,"component-emitter":12,querystring:18,"sc-errors":21,ws:7}],7:[function(t,e,n){var r="undefined"!=typeof WorkerGlobalScope?self:"undefined"!=typeof window&&window||function(){return this}(),o=r.WebSocket||r.MozWebSocket;function i(t,e,n){t=e?new o(t,e):new o(t);return t}o&&(i.prototype=o.prototype),e.exports=o?i:null},{}],8:[function(t,l,p){!function(c){!function(t){var e="object"==typeof p&&p,n="object"==typeof l&&l&&l.exports==e&&l,r="object"==typeof c&&c;r.global!==r&&r.window!==r||(t=r);var o=function(t){this.message=t};o.prototype=new Error,o.prototype.name="InvalidCharacterError";function u(t){throw new o(t)}var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=/[\t\n\f\r ]/g,i={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var e,n,r,o,i=t.length%3,s="",a=-1,c=t.length-i;++a<c;)e=t.charCodeAt(a)<<16,n=t.charCodeAt(++a)<<8,r=t.charCodeAt(++a),s+=h.charAt((o=e+n+r)>>18&63)+h.charAt(o>>12&63)+h.charAt(o>>6&63)+h.charAt(63&o);return 2==i?(e=t.charCodeAt(a)<<8,n=t.charCodeAt(++a),s+=h.charAt((o=e+n)>>10)+h.charAt(o>>4&63)+h.charAt(o<<2&63)+"="):1==i&&(o=t.charCodeAt(a),s+=h.charAt(o>>2)+h.charAt(o<<4&63)+"=="),s},decode:function(t){var e=(t=String(t).replace(a,"")).length;(e=e%4==0?(t=t.replace(/==?$/,"")).length:e)%4!=1&&!/[^+a-zA-Z0-9/]/.test(t)||u("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,o=0,i="",s=-1;++s<e;)r=h.indexOf(t.charAt(s)),n=o%4?64*n+r:r,o++%4&&(i+=String.fromCharCode(255&n>>(-2*o&6)));return i},version:"0.1.0"};if(0,e&&!e.nodeType)if(n)n.exports=i;else for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s]);else t.base64=i}(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(t,e,n){"use strict";n.byteLength=function(t){return 3*t.length/4-l(t)},n.toByteArray=function(t){var e,n,r,o,i,s=t.length;o=l(t),i=new h(3*s/4-o),n=0<o?s-4:s;var a=0;for(e=0;e<n;e+=4)r=u[t.charCodeAt(e)]<<18|u[t.charCodeAt(e+1)]<<12|u[t.charCodeAt(e+2)]<<6|u[t.charCodeAt(e+3)],i[a++]=r>>16&255,i[a++]=r>>8&255,i[a++]=255&r;2===o?(r=u[t.charCodeAt(e)]<<2|u[t.charCodeAt(e+1)]>>4,i[a++]=255&r):1===o&&(r=u[t.charCodeAt(e)]<<10|u[t.charCodeAt(e+1)]<<4|u[t.charCodeAt(e+2)]>>2,i[a++]=r>>8&255,i[a++]=255&r);return i},n.fromByteArray=function(t){for(var e,n=t.length,r=n%3,o="",i=[],s=0,a=n-r;s<a;s+=16383)i.push(function(t,e,n){for(var r,o=[],i=e;i<n;i+=3)r=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),o.push(function(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}(r));return o.join("")}(t,s,a<s+16383?a:s+16383));1==r?(e=t[n-1],o+=c[e>>2],o+=c[e<<4&63],o+="=="):2==r&&(e=(t[n-2]<<8)+t[n-1],o+=c[e>>10],o+=c[e>>4&63],o+=c[e<<2&63],o+="=");return i.push(o),i.join("")};for(var c=[],u=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=r.length;o<i;++o)c[o]=r[o],u[r.charCodeAt(o)]=o;function l(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},{}],10:[function(t,e,n){"use strict";var a=t("base64-js"),i=t("ieee754");n.Buffer=l,n.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},n.INSPECT_MAX_BYTES=50;var r=2147483647;function o(t){if(r<t)throw new RangeError("Invalid typed array length");t=new Uint8Array(t);return t.__proto__=l.prototype,t}function l(t,e,n){if("number"!=typeof t)return s(t,e,n);if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(t)}function s(t,e,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return N(t)||t&&N(t.buffer)?function(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');n=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n);return n.__proto__=l.prototype,n}(t,e,n):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var n=0|f(t,e),r=o(n),e=r.write(t,e);e!==n&&(r=r.slice(0,e));return r}(t,e):function(t){if(l.isBuffer(t)){var e=0|p(t.length),n=o(e);return 0===n.length?n:(t.copy(n,0,0,e),n)}if(t){if(ArrayBuffer.isView(t)||"length"in t)return"number"!=typeof t.length||L(t.length)?o(0):h(t);if("Buffer"===t.type&&Array.isArray(t.data))return h(t.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t){return c(t),o(t<0?0:0|p(t))}function h(t){for(var e=t.length<0?0:0|p(t.length),n=o(e),r=0;r<e;r+=1)n[r]=255&t[r];return n}function p(t){if(r<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|t}function f(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||N(t))return t.byteLength;var n=(t="string"!=typeof t?""+t:t).length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return O(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return I(t).length;default:if(r)return O(t).length;e=(""+e).toLowerCase(),r=!0}}function d(t,e,n){var r,o,i,s=!1;if((e=void 0===e||e<0?0:e)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,e,n){var r=t.length;(!e||e<0)&&(e=0);(!n||n<0||r<n)&&(n=r);for(var o="",i=e;i<n;++i)o+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[i]);return o}(this,e,n);case"utf8":case"utf-8":return E(this,e,n);case"ascii":return function(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}(this,e,n);case"latin1":case"binary":return function(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}(this,e,n);case"base64":return r=this,i=n,0===(o=e)&&i===r.length?a.fromByteArray(r):a.fromByteArray(r.slice(o,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}(this,e,n);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}function y(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function m(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),(n=(n=L(n=+n)?o?0:t.length-1:n)<0?t.length+n:n)>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:g(t,e,n,r,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,n):g(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,r,o){var i=1,s=t.length,a=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s/=i=2,a/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(o)for(var u=-1,h=n;h<s;h++)if(c(t,h)===c(e,-1===u?0:h-u)){if(h-(u=-1===u?h:u)+1===a)return u*i}else-1!==u&&(h-=h-u),u=-1;else for(h=n=s<n+a?s-a:n;0<=h;h--){for(var l=!0,p=0;p<a;p++)if(c(t,h+p)!==c(e,p)){l=!1;break}if(l)return h}return-1}function b(t,e,n,r){return B(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function v(t,e,n,r){return B(function(t,e){for(var n,r,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=t.charCodeAt(i),n=r>>8,r=r%256,o.push(r),o.push(n);return o}(e,t.length-n),t,n,r)}function E(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i,s,a,c,u=t[o],h=null,l=239<u?4:223<u?3:191<u?2:1;if(o+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(i=t[o+1]))&&127<(c=(31&u)<<6|63&i)&&(h=c);break;case 3:i=t[o+1],s=t[o+2],128==(192&i)&&128==(192&s)&&2047<(c=(15&u)<<12|(63&i)<<6|63&s)&&(c<55296||57343<c)&&(h=c);break;case 4:i=t[o+1],s=t[o+2],a=t[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)&&c<1114112&&(h=c)}null===h?(h=65533,l=1):65535<h&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),o+=l}return function(t){var e=t.length;if(e<=w)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=w));return n}(r)}n.kMaxLength=r,(l.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{get:function(){if(this instanceof l)return this.buffer}}),Object.defineProperty(l.prototype,"offset",{get:function(){if(this instanceof l)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=s,l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(t,e,n){return e=e,n=n,c(t=t),!(t<=0)&&void 0!==e?"string"==typeof n?o(t).fill(e,n):o(t).fill(e):o(t)},l.allocUnsafe=u,l.allocUnsafeSlow=u,l.isBuffer=function(t){return null!=t&&!0===t._isBuffer},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);if(void 0===e)for(o=e=0;o<t.length;++o)e+=t[o].length;for(var n=l.allocUnsafe(e),r=0,o=0;o<t.length;++o){var i=t[o];if(ArrayBuffer.isView(i)&&(i=l.from(i)),!l.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,r),r+=i.length}return n},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?E(this,0,t):d.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,n,r,o){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),(e=void 0===e?0:e)<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(o<=r&&n<=e)return 0;if(o<=r)return-1;if(n<=e)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(e>>>=0),a=Math.min(i,s),c=this.slice(r,o),u=t.slice(e,n),h=0;h<a;++h)if(c[h]!==u[h]){i=c[h],s=u[h];break}return i<s?-1:s<i?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return m(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return m(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||o<n)&&(n=o),0<t.length&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var i,s,a,c=!1;;)switch(r){case"hex":return function(t,e,n,r){n=Number(n)||0;var o=t.length-n;(!r||o<(r=Number(r)))&&(r=o),(o=e.length)/2<r&&(r=o/2);for(var i=0;i<r;++i){var s=parseInt(e.substr(2*i,2),16);if(L(s))return i;t[n+i]=s}return i}(this,t,e,n);case"utf8":case"utf-8":return s=e,a=n,B(O(t,(i=this).length-s),i,s,a);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return b(this,t,e,n);case"base64":return i=this,s=e,a=n,B(I(t),i,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,t,e,n);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function _(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(n<t+e)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,n,r,o,i){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<e||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function S(t,e,n,r){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(t,e,n,r,o){return e=+e,n>>>=0,o||S(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function C(t,e,n,r,o){return e=+e,n>>>=0,o||S(t,0,n,8),i.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),e<t&&(e=t);e=this.subarray(t,e);return e.__proto__=l.prototype,e},l.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||_(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},l.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||_(t,e,this.length);for(var r=this[t+--e],o=1;0<e&&(o*=256);)r+=this[t+--e]*o;return r},l.prototype.readUInt8=function(t,e){return t>>>=0,e||_(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||_(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||_(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||_(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||_(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||_(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return(o*=128)<=r&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||_(t,e,this.length);for(var r=e,o=1,i=this[t+--r];0<r&&(o*=256);)i+=this[t+--r]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*e)),i},l.prototype.readInt8=function(t,e){return t>>>=0,e||_(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||_(t,2,this.length);t=this[t]|this[t+1]<<8;return 32768&t?4294901760|t:t},l.prototype.readInt16BE=function(t,e){t>>>=0,e||_(t,2,this.length);t=this[t+1]|this[t]<<8;return 32768&t?4294901760|t:t},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||_(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||_(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return t>>>=0,e||_(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||_(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||_(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||_(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||T(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},l.prototype.writeUIntBE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||T(this,t,e,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[e+o]=255&t;0<=--o&&(i*=256);)this[e+o]=t/i&255;return e+n},l.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeIntLE=function(t,e,n,r){t=+t,e>>>=0,r||T(this,t,e,n,(r=Math.pow(2,8*n-1))-1,-r);var o=0,i=1,s=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/i>>0)-s&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){t=+t,e>>>=0,r||T(this,t,e,n,(r=Math.pow(2,8*n-1))-1,-r);var o=n-1,i=1,s=0;for(this[e+o]=255&t;0<=--o&&(i*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/i>>0)-s&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,1,127,-128),this[e]=255&(t=t<0?255+t+1:t),e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||T(this,t,e,4,2147483647,-2147483648),this[e]=(t=t<0?4294967295+t+1:t)>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeFloatLE=function(t,e,n){return k(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return k(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return C(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return C(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n=n||0,r||0===r||(r=this.length),e>=t.length&&(e=t.length),(r=0<r&&r<n?n:r)===n)return 0;if(0===t.length||0===this.length)return 0;if((e=e||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var o=(r=t.length-e<r-n?t.length-e+n:r)-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,n,r);else if(this===t&&n<e&&e<r)for(var i=o-1;0<=i;--i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,r),e);return o},l.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var o;1===t.length&&(o=t.charCodeAt(0),("utf8"===r&&o<128||"latin1"===r)&&(t=o))}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(t=t||0))for(i=e;i<n;++i)this[i]=t;else{var s=l.isBuffer(t)?t:new l(t,r),a=s.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=s[i%a]}return this};var A=/[^+/0-9A-Za-z-_]/g;function O(t,e){var n;e=e||1/0;for(var r=t.length,o=null,i=[],s=0;s<r;++s){if(55295<(n=t.charCodeAt(s))&&n<57344){if(!o){if(56319<n){-1<(e-=3)&&i.push(239,191,189);continue}if(s+1===r){-1<(e-=3)&&i.push(239,191,189);continue}o=n;continue}if(n<56320){-1<(e-=3)&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&-1<(e-=3)&&i.push(239,191,189);if(o=null,n<128){if(--e<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function I(t){return a.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(A,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function B(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function N(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function L(t){return t!=t}},{"base64-js":9,ieee754:13}],11:[function(t,e,n){!function(k){var t=function(){"use strict";function v(t,e){return null!=e&&t instanceof e}var E,w,_;try{E=Map}catch(t){E=function(){}}try{w=Set}catch(t){w=function(){}}try{_=Promise}catch(t){_=function(){}}function T(t,f,e,d,y){"object"==typeof f&&(e=f.depth,d=f.prototype,y=f.includeNonEnumerable,f=f.circular);var m=[],g=[],b=void 0!==k;return void 0===f&&(f=!0),function r(t,o){if(null===t)return null;if(0===o)return t;var n,e,i;if("object"!=typeof t)return t;if(v(t,E))n=new E;else if(v(t,w))n=new w;else if(v(t,_))n=new _(function(e,n){t.then(function(t){e(r(t,o-1))},function(t){n(r(t,o-1))})});else if(T.__isArray(t))n=[];else if(T.__isRegExp(t))n=new RegExp(t.source,S(t)),t.lastIndex&&(n.lastIndex=t.lastIndex);else if(T.__isDate(t))n=new Date(t.getTime());else{if(b&&k.isBuffer(t))return n=new k(t.length),t.copy(n),n;v(t,Error)?n=Object.create(t):void 0===d?(e=Object.getPrototypeOf(t),n=Object.create(e)):(n=Object.create(d),e=d)}if(f){var s=m.indexOf(t);if(-1!=s)return g[s];m.push(t),g.push(n)}for(c in v(t,E)&&t.forEach(function(t,e){e=r(e,o-1),t=r(t,o-1),n.set(e,t)}),v(t,w)&&t.forEach(function(t){t=r(t,o-1),n.add(t)}),t)(i=e?Object.getOwnPropertyDescriptor(e,c):i)&&null==i.set||(n[c]=r(t[c],o-1));if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(t),c=0;c<a.length;c++){var u=a[c];(l=Object.getOwnPropertyDescriptor(t,u))&&!l.enumerable&&!y||(n[u]=r(t[u],o-1),l.enumerable||Object.defineProperty(n,u,{enumerable:!1}))}if(y)for(var h=Object.getOwnPropertyNames(t),c=0;c<h.length;c++){var l,p=h[c];(l=Object.getOwnPropertyDescriptor(t,p))&&l.enumerable||(n[p]=r(t[p],o-1),Object.defineProperty(n,p,{enumerable:!1}))}return n}(t,e=void 0===e?1/0:e)}function e(t){return Object.prototype.toString.call(t)}function S(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return T.clonePrototype=function(t){if(null===t)return null;function e(){}return e.prototype=t,new e},T.__objToStr=e,T.__isDate=function(t){return"object"==typeof t&&"[object Date]"===e(t)},T.__isArray=function(t){return"object"==typeof t&&"[object Array]"===e(t)},T.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===e(t)},T.__getRegExpFlags=S,T}();"object"==typeof e&&e.exports&&(e.exports=t)}.call(this,t("buffer").Buffer)},{buffer:10}],12:[function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}void 0!==e&&(e.exports=r),r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<r.length;o++)if((n=r[o])===e||n.fn===e){r.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],13:[function(t,e,n){n.read=function(t,e,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?o-1:0,p=n?-1:1,n=t[e+l];for(l+=p,i=n&(1<<-h)-1,n>>=-h,h+=a;0<h;i=256*i+t[e+l],l+=p,h-=8);for(s=i&(1<<-h)-1,i>>=-h,h+=r;0<h;s=256*s+t[e+l],l+=p,h-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,r),i-=u}return(n?-1:1)*s*Math.pow(2,i-r)},n.write=function(t,e,n,r,o,i){var s,a,c=8*i-o-1,u=(1<<c)-1,h=u>>1,l=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,f=r?1:-1,i=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(e+=1<=s+h?l/r:l*Math.pow(2,1-h))*r&&(s++,r/=2),u<=s+h?(a=0,s=u):1<=s+h?(a=(e*r-1)*Math.pow(2,o),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,o),s=0));8<=o;t[n+p]=255&a,p+=f,a/=256,o-=8);for(s=s<<o|a,c+=o;0<c;t[n+p]=255&s,p+=f,s/=256,c-=8);t[n+p-f]|=128*i}},{}],14:[function(t,e,n){"use strict";var o;function r(){if(arguments.length)return r.from(arguments)}function i(){}o="An argument without append, prepend, or detach methods was given to `List",s=r.prototype,r.of=function(){return r.from.call(this,arguments)},r.from=function(t){var e,n,r,o=new this;if(t&&(e=t.length))for(n=-1;++n<e;)null!=(r=t[n])&&o.append(r);return o},s.head=null,s.tail=null,s.toArray=function(){for(var t=this.head,e=[];t;)e.push(t),t=t.next;return e},s.prepend=function(t){if(!t)return!1;if(!t.append||!t.prepend||!t.detach)throw new Error(o+"#prepend`.");var e=this.head;return e?e.prepend(t):(t.detach(),(t.list=this).head=t)},s.append=function(t){if(!t)return!1;if(!t.append||!t.prepend||!t.detach)throw new Error(o+"#append`.");var e=this.tail;return(e=e||this.head)?e.append(t):(t.detach(),(t.list=this).head=t)};var s=(r.Item=i).prototype;s.next=null,s.prev=null,s.list=null,s.detach=function(){var t=this,e=t.list,n=t.prev,r=t.next;return e&&(e.tail===t&&(e.tail=n),e.head===t&&(e.head=r),e.tail===e.head&&(e.tail=null),n&&(n.next=r),r&&(r.prev=n),t.prev=t.next=t.list=null),t},s.prepend=function(t){if(!(t&&t.append&&t.prepend&&t.detach))throw new Error(o+"Item#prepend`.");var e=this,n=e.list,r=e.prev;return!!n&&(t.detach(),r&&((t.prev=r).next=t),t.next=e,t.list=n,e.prev=t,e===n.head&&(n.head=t),n.tail||(n.tail=e),t)},s.append=function(t){if(!(t&&t.append&&t.prepend&&t.detach))throw new Error(o+"Item#append`.");var e=this,n=e.list,r=e.next;return!!n&&(t.detach(),r&&((t.next=r).prev=t),t.prev=e,t.list=n,e.next=t,e!==n.tail&&n.tail||(n.tail=t),t)},e.exports=r},{}],15:[function(t,e,n){"use strict";e.exports=t("./_source/linked-list.js")},{"./_source/linked-list.js":14}],16:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var i=/\+/g;t=t.split(e=e||"&");e=1e3;r&&"number"==typeof r.maxKeys&&(e=r.maxKeys);var s=t.length;0<e&&e<s&&(s=e);for(var a=0;a<s;++a){var c,u=t[a].replace(i,"%20"),h=u.indexOf(n),h=0<=h?(c=u.substr(0,h),u.substr(h+1)):(c=u,""),u=decodeURIComponent(c),h=decodeURIComponent(h);Object.prototype.hasOwnProperty.call(o,u)?l(o[u])?o[u].push(h):o[u]=[o[u],h]:o[u]=h}return o};var l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],17:[function(t,e,n){"use strict";function i(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}e.exports=function(n,r,o,t){return r=r||"&",o=o||"=","object"==typeof(n=null===n?void 0:n)?a(c(n),function(t){var e=encodeURIComponent(i(t))+o;return s(n[t])?a(n[t],function(t){return e+encodeURIComponent(i(t))}).join(r):e+encodeURIComponent(i(n[t]))}).join(r):t?encodeURIComponent(i(t))+o+encodeURIComponent(i(n)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function a(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var c=Object.keys||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(e);return n}},{}],18:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":16,"./encode":17}],19:[function(t,e,n){var r=t("component-emitter"),t=function(t,e,n){r.call(this),this.PENDING="pending",this.SUBSCRIBED="subscribed",this.UNSUBSCRIBED="unsubscribed",this.name=t,this.state=this.UNSUBSCRIBED,this.client=e,this.options=n||{},this.setOptions(this.options)};(t.prototype=Object.create(r.prototype)).setOptions=function(t){this.waitForAuth=(t=t||{}).waitForAuth||!1,this.batch=t.batch||!1,void 0!==t.data&&(this.data=t.data)},t.prototype.getState=function(){return this.state},t.prototype.subscribe=function(t){this.client.subscribe(this.name,t)},t.prototype.unsubscribe=function(){this.client.unsubscribe(this.name)},t.prototype.isSubscribed=function(t){return this.client.isSubscribed(this.name,t)},t.prototype.publish=function(t,e){this.client.publish(this.name,t,e)},t.prototype.watch=function(t){this.client.watch(this.name,t)},t.prototype.unwatch=function(t){this.client.unwatch(this.name,t)},t.prototype.watchers=function(){return this.client.watchers(this.name)},t.prototype.destroy=function(){this.client.destroyChannel(this.name)},e.exports.SCChannel=t},{"component-emitter":12}],20:[function(t,e,n){e.exports=function(t){var s=[],a=[];return function t(e,n){var r,o,i;if("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String)return e;for(r=0;r<s.length;r+=1)if(s[r]===e)return{$ref:a[r]};if(s.push(e),a.push(n),"[object Array]"===Object.prototype.toString.apply(e))for(i=[],r=0;r<e.length;r+=1)i[r]=t(e[r],n+"["+r+"]");else for(o in i={},e)Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=t(e[o],n+"["+JSON.stringify(o)+"]"));return i}(t,"$")}},{}],21:[function(t,e,n){var o=t("./decycle"),r=function(){return!this}();function i(t,e){this.name="AuthTokenExpiredError",this.message=t,this.expiry=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function s(t){this.name="AuthTokenInvalidError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function a(t,e){this.name="AuthTokenNotBeforeError",this.message=t,this.date=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function c(t){this.name="AuthTokenError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function u(t,e){this.name="SilentMiddlewareBlockedError",this.message=t,this.type=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function h(t){this.name="InvalidActionError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function l(t){this.name="InvalidArgumentsError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function p(t){this.name="InvalidOptionsError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function f(t){this.name="InvalidMessageError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function d(t,e){this.name="SocketProtocolError",this.message=t,this.code=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function y(t){this.name="ServerProtocolError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function m(t){this.name="HTTPServerError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function g(t){this.name="ResourceLimitError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function b(t){this.name="TimeoutError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function v(t,e){this.name="BadConnectionError",this.message=t,this.type=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function E(t){this.name="BrokerError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function w(t,e){this.name="ProcessExitError",this.message=t,this.code=e,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function _(t){this.name="UnknownError",this.message=t,Error.captureStackTrace&&!r?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}i.prototype=Object.create(Error.prototype),s.prototype=Object.create(Error.prototype),a.prototype=Object.create(Error.prototype),c.prototype=Object.create(Error.prototype),u.prototype=Object.create(Error.prototype),h.prototype=Object.create(Error.prototype),l.prototype=Object.create(Error.prototype),p.prototype=Object.create(Error.prototype),f.prototype=Object.create(Error.prototype),d.prototype=Object.create(Error.prototype),y.prototype=Object.create(Error.prototype),m.prototype=Object.create(Error.prototype),g.prototype=Object.create(Error.prototype),b.prototype=Object.create(Error.prototype),v.prototype=Object.create(Error.prototype),E.prototype=Object.create(Error.prototype),w.prototype=Object.create(Error.prototype),_.prototype=Object.create(Error.prototype),e.exports={AuthTokenExpiredError:i,AuthTokenInvalidError:s,AuthTokenNotBeforeError:a,AuthTokenError:c,SilentMiddlewareBlockedError:u,InvalidActionError:h,InvalidArgumentsError:l,InvalidOptionsError:p,InvalidMessageError:f,SocketProtocolError:d,ServerProtocolError:y,HTTPServerError:m,ResourceLimitError:g,TimeoutError:b,BadConnectionError:v,BrokerError:E,ProcessExitError:w,UnknownError:_},e.exports.socketProtocolErrorStatuses={1001:"Socket was disconnected",1002:"A WebSocket protocol error was encountered",1003:"Server terminated socket because it received invalid data",1005:"Socket closed without status code",1006:"Socket hung up",1007:"Message format was incorrect",1008:"Encountered a policy violation",1009:"Message was too big to process",1010:"Client ended the connection because the server did not comply with extension requirements",1011:"Server encountered an unexpected fatal condition",4e3:"Server ping timed out",4001:"Client pong timed out",4002:"Server failed to sign auth token",4003:"Failed to complete handshake",4004:"Client failed to save auth token",4005:"Did not receive #handshake from client before timeout",4006:"Failed to bind socket to message broker",4007:"Client connection establishment timed out",4008:"Server rejected handshake from client"},e.exports.socketProtocolIgnoreStatuses={1e3:"Socket closed normally",1001:"Socket hung up"};var T={domain:1,domainEmitter:1,domainThrown:1};e.exports.dehydrateError=function(t,e){var n;if(t&&"object"==typeof t)for(var r in n={message:t.message},e&&(n.stack=t.stack),t)T[r]||(n[r]=t[r]);else n="function"==typeof t?"[function "+(t.name||"anonymous")+"]":t;return o(n)},e.exports.hydrateError=function(t){var e=null;if(null!=t)if("object"==typeof t)for(var n in e=new Error(t.message),t)t.hasOwnProperty(n)&&(e[n]=t[n]);else e=t;return e},e.exports.decycle=o},{"./decycle":20}],22:[function(t,o,e){!function(r){function e(t,e){if(r.ArrayBuffer&&e instanceof r.ArrayBuffer)return{base64:!0,data:function(t){for(var e=new Uint8Array(t),n=e.length,r="",o=0;o<n;o+=3)r+=i[e[o]>>2],r+=i[(3&e[o])<<4|e[o+1]>>4],r+=i[(15&e[o+1])<<2|e[o+2]>>6],r+=i[63&e[o+2]];return n%3==2?r=r.substring(0,r.length-1)+"=":n%3==1&&(r=r.substring(0,r.length-2)+"=="),r}(e)};if(r.Buffer){if(e instanceof r.Buffer)return{base64:!0,data:e.toString("base64")};if(e&&"Buffer"===e.type&&Array.isArray(e.data)){var n=r.Buffer.from?r.Buffer.from(e.data):new r.Buffer(e.data);return{base64:!0,data:n.toString("base64")}}}return e}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=/^[ \n\r\t]*[{\[]/;o.exports.decode=function(t){if(null==t)return null;if("#1"===t||"#2"===t)return t;t=t.toString();if(!n.test(t))return t;try{return JSON.parse(t)}catch(t){}return t},o.exports.encode=function(t){return"#1"===t||"#2"===t?t:JSON.stringify(t,e)}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(t,e,n){var r=t("./v1"),o=t("./v4"),t=o;t.v1=r,t.v4=o,e.exports=t},{"./v1":26,"./v4":27}],24:[function(t,e,n){for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);e.exports=function(t,e){return e=e||0,r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]}},{}],25:[function(t,e,n){var r,o,i="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);i?(r=new Uint8Array(16),e.exports=function(){return i(r),r}):(o=new Array(16),e.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o})},{}],26:[function(t,e,n){var h,l,p=t("./lib/rng"),f=t("./lib/bytesToUuid"),d=0,y=0;e.exports=function(t,e,n){var r=e&&n||0,o=e||[],i=(t=t||{}).node||h,s=void 0!==t.clockseq?t.clockseq:l;null!=i&&null!=s||(c=p(),null==i&&(i=h=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==s&&(s=l=16383&(c[6]<<8|c[7])));var a=void 0!==t.msecs?t.msecs:(new Date).getTime(),n=void 0!==t.nsecs?t.nsecs:y+1,c=a-d+(n-y)/1e4;if(c<0&&void 0===t.clockseq&&(s=s+1&16383),1e4<=(n=(c<0||d<a)&&void 0===t.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=a,l=s,n=(1e4*(268435455&(a+=122192928e5))+(y=n))%4294967296,o[r++]=n>>>24&255,o[r++]=n>>>16&255,o[r++]=n>>>8&255,o[r++]=255&n,a=a/4294967296*1e4&268435455,o[r++]=a>>>8&255,o[r++]=255&a,o[r++]=a>>>24&15|16,o[r++]=a>>>16&255,o[r++]=s>>>8|128,o[r++]=255&s;for(var u=0;u<6;++u)o[r+u]=i[u];return e||f(o)}},{"./lib/bytesToUuid":24,"./lib/rng":25}],27:[function(t,e,n){var s=t("./lib/rng"),a=t("./lib/bytesToUuid");e.exports=function(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;++i)e[r+i]=o[i];return e||a(o)}},{"./lib/bytesToUuid":24,"./lib/rng":25}]},{},[1])(1)});var channelList=[],channelListMail=[];!function(){var t={hostname:lh.nodejsHelperOptions.hostname,path:lh.nodejsHelperOptions.path,authTokenName:"socketCluster.authToken_admin",autoReconnectOptions:{initialDelay:5e3,randomness:5e3}};""!=lh.nodejsHelperOptions.port&&(t.port=parseInt(lh.nodejsHelperOptions.port)),1==lh.nodejsHelperOptions.secure&&(t.secure=!0);var e=null,n=0<lh.nodejsHelperOptions.instance_id?"chat_"+lh.nodejsHelperOptions.instance_id+"_"+lhinst.chat_id:"chat_"+lhinst.chat_id,r=socketCluster.connect(t);function o(n){try{void 0===channelList[n]&&(0<lh.nodejsHelperOptions.instance_id?channelList[n]=r.subscribe("chat_"+lh.nodejsHelperOptions.instance_id+"_"+n):channelList[n]=r.subscribe("chat_"+n),channelList[n].on("subscribeFail",function(t){console.error("Failed to subscribe to the sample channel due to error: "+t)}),channelList[n].on("subscribe",function(t){$("#user-is-typing-"+n).html('<span id="node-js-indicator-'+n+'" class="text-danger fs12"><span class="material-icons fs12">wifi_off</span><span class="node-js-online-status">'+lh.nodejsHelperOptions.trans.offline+"</span></span>").css("visibility","visible"),ee.emitEvent("nodeJsVisitorStatus",[{id:n,status:!1}]),r.publish(t,{op:"vo"})}),channelList[n].watch(function(t){var e=$("#user-is-typing-"+n);"vt"==t.op?(e.text(t.msg).css("visibility","visible"),ee.emitEvent("nodeJsTypingVisitor",[{id:n,txt:t.msg}])):"vts"==t.op?(e.text(t.msg).css("visibility","hidden"),ee.emitEvent("nodeJsTypingVisitorStopped",[{id:n}])):"msgread"==t.op?$("#messagesBlock-"+t.cid).find(".msg-del-st-0,.msg-del-st-1,.msg-del-st-2").remove():"msgdel"==t.op?$("#messagesBlock-"+t.cid).find(".msg-del-st-0,.msg-del-st-1").removeClass("msg-del-st-0 msg-del-st-1").addClass("msg-del-st-2").text("done_all"):"cmsg"==t.op?lhinst.syncadmincall():"umsg"==t.op?lhinst.updateMessageRowAdmin(n,t.msid):"vi_online"==t.op?(e.html('<span id="node-js-indicator-'+n+'" class="fs12 '+(1==t.status?"text-success":"text-danger")+'"><span class="material-icons fs12">'+(1==t.status?"wifi":"wifi_off")+'</span><span class="node-js-online-status">'+(1==t.status?lh.nodejsHelperOptions.trans.online:lh.nodejsHelperOptions.trans.offline)+"</span></span>").css("visibility","visible"),ee.emitEvent("nodeJsVisitorStatus",[{id:n,status:t.status}])):"uchat"==t.op?ee.emitEvent("updateChatTab",[{id:n}]):"schange"==t.op?lhinst.updateVoteStatus(n):"cclose"==t.op&&lhinst.reloadTab(n,$("#tabs"),t.nick)}))}catch(t){console.log(t)}}function i(t){var e=document.getElementById("chat-owner-"+t.chat_id);null!==e&&confLH.user_id!=e.getAttribute("user-id")||(t.ttx=null!==e&&e.getAttribute("title")?e.getAttribute("title")+" "+lh.nodejsHelperOptions.typer_ending_txt:lh.nodejsHelperOptions.typer,t.typer=null!==e&&e.getAttribute("title")?e.getAttribute("title"):lh.nodejsHelperOptions.name_support,ee.emitEvent("nodeJsTypingOperator",[t]),0<lh.nodejsHelperOptions.instance_id?r.publish("chat_"+lh.nodejsHelperOptions.instance_id+"_"+t.chat_id,{op:"ot",data:t}):r.publish("chat_"+t.chat_id,{op:"ot",data:t}))}function s(t){try{void 0!==channelList[t]&&(channelList[t].destroy(),delete channelList[t])}catch(t){console.log(t)}}r.on("error",function(t){console.error(t)});var a=[];function c(t){var n;0!==lh.nodejsHelperOptions.track_visitors&&(n=[],t.forEach(function(t,e){-1===a.indexOf(t.vid)&&r.publish("uo_"+t.vid,{op:"is_online"}),n.push(t.vid)}),a=n)}function u(t){0!==lh.nodejsHelperOptions.track_visitors&&t.forEach(function(t){r.publish("uo_"+t,{op:"is_online"})})}function h(t){if(void 0!==channelListMail[t]){channelListMail[t].publish({op:"opleft",user_id:confLH.user_id}),clearInterval(channelListMail[t].monitoring_timeout);try{void 0!==channelListMail[t]&&(channelListMail[t].destroy(),delete channelListMail[t])}catch(t){console.log(t)}}}function l(e){try{void 0===channelListMail[e]&&(0<lh.nodejsHelperOptions.instance_id?channelListMail[e]=r.subscribe("mail_"+lh.nodejsHelperOptions.instance_id+"_"+e):channelListMail[e]=r.subscribe("mail_"+e),channelListMail[e].on("subscribeFail",function(t){console.error("Failed to subscribe to the sample channel due to error: "+t)}),channelListMail[e].on("subscribe",function(t){r.publish(t,{op:"oo",user_id:confLH.user_id,name_official:lh.nodejsHelperOptions.name_official})}),channelListMail[e].watch(function(t){"oo"==t.op?(channelListMail[e].publish({op:"oos",user_id:confLH.user_id,name_official:lh.nodejsHelperOptions.name_official}),ee.emitEvent("mail.op_watching",[{id:e,status:!0,user_id:t.user_id,name_official:t.name_official}])):"opleft"==t.op&&t.user_id!=confLH.user_id?ee.emitEvent("mail.op_watching",[{id:e,status:!1,user_id:t.user_id}]):"oos"==t.op&&t.user_id!=confLH.user_id&&ee.emitEvent("mail.op_watching",[{id:e,status:!0,user_id:t.user_id,name_official:t.name_official}])}),channelListMail[e].monitoring_timeout=setInterval(function(){channelListMail[e].publish({op:"oo",user_id:confLH.user_id,name_official:lh.nodejsHelperOptions.name_official})},5e3))}catch(t){console.log(t)}}function p(){try{lhinst.nodeJsMode=!0,lhinst.chatsSynchronising.forEach(function(t){o(t)}),ee.addListener("chatTabMonitor",o),ee.addListener("chatTabLoaded",o),ee.addListener("operatorTyping",i),ee.addListener("removeSynchroChat",s),ee.addListener("chatAdminSyncOnlineVisitors",c),ee.addListener("chatAdminIsOnline",u),ee.addListener("mailChatContentUnLoaded",h),ee.addListener("mailChatContentLoaded",l),confLH.chat_message_sinterval=15e3,(e=r.subscribe("ous_"+lh.nodejsHelperOptions.instance_id)).on("subscribeFail",function(t){console.error("Failed to subscribe to the online users channel due to error: "+t)}),e.watch(function(t){var e;"vi_online"==t.op?(null!==(e=document.getElementById("uo-vid-"+t.vid))&&(!0===t.status?(e.classList.add("online_user"),document.getElementById("ou-face-"+t.vid).classList.add("icon-user-online")):(e.classList.remove("online_user"),e.classList.remove("recent_visit"),document.getElementById("ou-face-"+t.vid).classList.remove("icon-user-online"))),null!==(e=document.getElementById("mass-uo-vid-"+t.vid))&&(!0===t.status?(e.classList.add("online_user"),document.getElementById("mass-ou-face-"+t.vid).classList.add("icon-user-online")):(e.classList.remove("online_user"),e.classList.remove("recent_visit"),document.getElementById("mass-ou-face-"+t.vid).classList.remove("icon-user-online")))):"notice_updated"==t.op?ee.emitEvent("svelteNoticeUpdated",[]):"reload_page"==t.op&&document.location.reload()}),ee.emitEvent("socketConnected",[r])}catch(t){console.log(t)}}r.on("close",function(){try{lhinst.nodeJsMode=!1,channelList=[],ee.removeListener("chatTabLoaded",o),ee.removeListener("chatTabMonitor",o),ee.removeListener("operatorTyping",i),ee.removeListener("removeSynchroChat",s),confLH.chat_message_sinterval=confLH.defaut_chat_message_sinterval,ee.emitEvent("socketDisconnected",[r])}catch(t){console.log(t)}}),r.on("deauthenticate",function(){$.postJSON(WWW_DIR_JAVASCRIPT+"nodejshelper/tokenadmin",function(t){r.emit("login",{hash:t.hash,chanelName:n,instance_id:t.instance_id},function(t){t&&(console.log(t),r.destroy())})})}),r.on("connect",function(t){t.isAuthenticated?p():$.postJSON(WWW_DIR_JAVASCRIPT+"nodejshelper/tokenadmin",function(t){r.emit("login",{hash:t.hash,chanelName:n,instance_id:t.instance_id},function(t){t?(console.log(t),r.destroy()):p()})})}),$(window).on("beforeunload",function(){r.destroy()})}();